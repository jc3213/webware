const MediaInspector = function (callback) {
    const proto = HTMLMediaElement.prototype;
    const descriptor = Object.getOwnPropertyDescriptor(proto, 'src');

    if (proto.__mediaInspected_) {
        throw new SyntaxError('MediaInspector has already been applied to HTMLMediaElement.prototype.src');
    }

    proto.__mediaInspected_ = true;

    Object.defineProperty(proto, 'src', {
        configurable: true,
        enumerable: true,
        get() {
            return descriptor.get.call(this);
        },
        set(value) {
            const oldValue = this.src;
            descriptor.set.call(this, value);

            requestAnimationFrame(() => {
                if (this.src !== oldValue) {
                    callback(this, this.src);
                }
            });
        }
   });
};
